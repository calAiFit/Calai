(()=>{var e={};e.id=2,e.ids=[2],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},37740:(e,t,a)=>{"use strict";a.d(t,{db:()=>n,A:()=>i,z:()=>s});let r=require("@prisma/client"),s=globalThis.prisma??new r.PrismaClient({log:["error"],errorFormat:"pretty"}),n={getProfileByUserId:async e=>s.profile.findUnique({where:{userId:e}}),upsertProfile:async(e,t)=>s.profile.upsert({where:{userId:e},update:t,create:{userId:e,name:t.name,avatarUrl:t.avatarUrl,...t.age&&{age:t.age},...t.gender&&{gender:t.gender},...t.height&&{height:t.height},...t.weight&&{weight:t.weight},...t.targetWeight&&{targetWeight:t.targetWeight},...t.activityLevel&&{activityLevel:t.activityLevel}}}),getDailyGoal:async(e,t)=>s.dailyGoal.findUnique({where:{userId_date:{userId:e,date:new Date(t.toDateString())}}}),upsertDailyGoal:async(e,t,a)=>s.dailyGoal.upsert({where:{userId_date:{userId:e,date:new Date(t.toDateString())}},update:a,create:{userId:e,date:new Date(t.toDateString()),...a}}),async addIntakeHistory(e,t){let a=await s.dailyIntakeHistory.create({data:{userId:e,date:new Date,...t}});return await this.updateDailySummary(e),a},async getIntakeHistory(e,t){let a=t||new Date;return s.dailyIntakeHistory.findMany({where:{userId:e,date:{gte:new Date(a.toDateString()),lt:new Date(new Date(a).setDate(a.getDate()+1))}},orderBy:{createdAt:"desc"}})},addWorkout:async(e,t)=>s.workout.create({data:{userId:e,date:new Date,...t}}),getWorkouts:async(e,t=10)=>s.workout.findMany({where:{userId:e},orderBy:{date:"desc"},take:t}),addFoodRecognition:async(e,t)=>s.foodRecognition.create({data:{userId:e,...t}}),getFoodRecognitions:async(e,t=10)=>s.foodRecognition.findMany({where:{userId:e},orderBy:{createdAt:"desc"},take:t}),async getWeeklyIntakeSummary(e){let t=new Date;return t.setDate(t.getDate()-7),s.dailyIntakeHistory.groupBy({by:["date"],where:{userId:e,date:{gte:t}},_sum:{calories:!0,protein:!0,carbs:!0,fats:!0},orderBy:{date:"asc"}})},async getMonthlyWorkoutSummary(e){let t=new Date;return t.setMonth(t.getMonth()-1),s.workout.findMany({where:{userId:e,date:{gte:t}},orderBy:{date:"desc"}})},async addBurnedCalories(e,t){let a=new Date;return s.dailyBurnedCalories.upsert({where:{userId_date_activity:{userId:e,date:new Date(a.toDateString()),activity:t.activity}},update:{calories:{increment:t.calories},duration:t.duration?{increment:t.duration}:void 0},create:{userId:e,date:new Date(a.toDateString()),...t}})},async getBurnedCalories(e,t){let a=t||new Date;return s.dailyBurnedCalories.findMany({where:{userId:e,date:{gte:new Date(a.toDateString()),lt:new Date(new Date(a).setDate(a.getDate()+1))}},orderBy:{createdAt:"desc"}})},async getTotalBurnedCalories(e,t){let a=t||new Date;return(await s.dailyBurnedCalories.aggregate({where:{userId:e,date:{gte:new Date(a.toDateString()),lt:new Date(new Date(a).setDate(a.getDate()+1))}},_sum:{calories:!0}}))._sum.calories||0},async getDailySummary(e,t){let a=t||new Date;return s.dailySummary.findUnique({where:{userId_date:{userId:e,date:new Date(a.toDateString())}}})},async updateDailySummary(e,t){let a=t||new Date,r=new Date(a.toDateString()),n=await s.dailyIntakeHistory.aggregate({where:{userId:e,date:{gte:r,lt:new Date(new Date(a).setDate(a.getDate()+1))}},_sum:{calories:!0,protein:!0,carbs:!0,fats:!0}}),i=await s.dailyBurnedCalories.aggregate({where:{userId:e,date:{gte:r,lt:new Date(new Date(a).setDate(a.getDate()+1))}},_sum:{calories:!0}}),o=n._sum.calories||0,d=i._sum.calories||0,u=o-d;return s.dailySummary.upsert({where:{userId_date:{userId:e,date:r}},update:{totalConsumed:o,totalBurned:d,netCalories:u,protein:n._sum.protein||0,carbs:n._sum.carbs||0,fats:n._sum.fats||0},create:{userId:e,date:r,totalConsumed:o,totalBurned:d,netCalories:u,protein:n._sum.protein||0,carbs:n._sum.carbs||0,fats:n._sum.fats||0}})},async getHistoricalData(e,t=7){let a=new Date;return a.setDate(a.getDate()-t),s.dailySummary.findMany({where:{userId:e,date:{gte:a}},orderBy:{date:"desc"}})},async resetDailyData(e,t){await this.updateDailySummary(e,t)}},i=s},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},59516:(e,t,a)=>{"use strict";a.r(t),a.d(t,{patchFetch:()=>D,routeModule:()=>c,serverHooks:()=>w,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>p});var r={};a.r(r),a.d(r,{GET:()=>l,POST:()=>y});var s=a(96559),n=a(48088),i=a(37719),o=a(32190),d=a(26291),u=a(37740);async function l(e){let{userId:t}=(0,d.xI)(e);if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});try{let{searchParams:a}=new URL(e.url),r=a.get("date"),s=r?new Date(r):new Date,n=await u.db.getDailySummary(t,s);n||(n=await u.db.updateDailySummary(t,s));let i=await u.db.getBurnedCalories(t,s),d=await u.db.getTotalBurnedCalories(t,s);return o.NextResponse.json({dailySummary:n,burnedCalories:i,totalBurned:d})}catch(e){return console.error("GET /api/daily-summary error:",e),o.NextResponse.json({error:"Failed to fetch daily summary"},{status:500})}}async function y(e){let{userId:t}=(0,d.xI)(e);if(!t)return o.NextResponse.json({error:"Unauthorized"},{status:401});try{let a=await e.json(),{action:r}=a;if("reset"===r){let{date:e}=a,r=e?new Date(e):new Date;return await u.db.resetDailyData(t,r),o.NextResponse.json({message:"Daily data reset successfully",date:r.toISOString().split("T")[0]})}if("update"===r){let{date:e}=a,r=e?new Date(e):new Date,s=await u.db.updateDailySummary(t,r);return o.NextResponse.json({dailySummary:s})}return o.NextResponse.json({error:"Invalid action"},{status:400})}catch(e){return console.error("POST /api/daily-summary error:",e),o.NextResponse.json({error:"Failed to process daily summary action"},{status:500})}}let c=new s.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/daily-summary/route",pathname:"/api/daily-summary",filename:"route",bundlePath:"app/api/daily-summary/route"},resolvedPagePath:"/Users/dorjotgoo/Desktop/Calai/frontend/src/app/api/daily-summary/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:g,workUnitAsyncStorage:p,serverHooks:w}=c;function D(){return(0,i.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:p})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},73024:e=>{"use strict";e.exports=require("node:fs")},76760:e=>{"use strict";e.exports=require("node:path")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},96487:()=>{},96559:(e,t,a)=>{"use strict";e.exports=a(44870)}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[80,291],()=>a(59516));module.exports=r})();